name: branch-build
on:
    push:
        branches: 
            - '*'
            - '!master'
jobs:
    setup-workflow:
      name: setup
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v4
        - name: Setup Go
          uses: actions/setup-go@v5
          with:
            go-version: '>=1.23.0'
        - name: Install dependencies
          run: |
              go version
              go get
        - name: test
          run: |
            go test -v ./...
    build:
        name: build
        runs-on: ubuntu-latest
        strategy:
            matrix:
                goos:
                    - linux
                goarch:
                    - amd64
                    - arm64
                flags:
                    - -trimpath
                ldflags:
                    - -s -w -X main.version={{.Version}} -X main.commit={{.Commit}} -X main.date={{ .CommitDate }} -X main.builtBy=goreleaser -X main.treeState={{ .IsGitDirty }}                  
        steps:
            - uses: actions/setup-go@v5
            - name: build
              env:
                GOOS: ${{ matrix.goos }}
                GOARCH: ${{ matrix.goarch }}
              run: |
                go build  -ldflags ${{ matrix.ldflags }} -mod vendor -trimpath  . 

    